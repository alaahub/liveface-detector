{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Detection Results â€” LiveFace</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* 1. Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ÙˆØ§Ù„Ø®Ø·ÙˆØ· */
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f0f2f5;
            margin: 0;
            padding: 30px;
            color: #344767;
            min-height: 100vh;
        }
        h2 {
            color: #344767;
            font-weight: 600;
            font-size: 2rem;
            margin: 0;
        }

        /* 2. Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¹Ù„ÙˆÙŠ (Top Bar) */
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }
        .controls {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        /* 3. Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… (Buttons) */
        .btn {
            border: none;
            border-radius: 10px;
            padding: 10px 18px;
            cursor: pointer;
            font-weight: 500;
            text-decoration: none;
            color: white;
            display: inline-block;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            font-size: 0.9rem;
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(0,0,0,0.15); }
        .btn-camera { background: linear-gradient(195deg, #a481dc, #8e44ad); }
        .btn-dashboard { background: linear-gradient(195deg, #4CAF50, #27ae60); }
        .btn-report-pdf { background: linear-gradient(195deg, #42a5f5, #1e88e5); }
        .btn-clear { background: linear-gradient(195deg, #ff7043, #e74c3c); }
        .filter-btn.active, .view-toggle button.active { opacity: 1; box-shadow: 0 0 0 3px #1e88e5; }
        .filter-btn { opacity: 0.7; }

        /* 4. Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¹Ø±Ø¶ ÙˆØ§Ù„ØªØµÙÙŠØ© */
        .view-controls {
            display: flex;
            gap: 20px;
        }
        .view-controls label {
            font-weight: 600;
            color: #67748e;
            margin-right: 10px;
        }
        .view-toggle button {
            background-color: #fff;
            color: #344767;
            border: 1px solid #ddd;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.2s;
        }
        .view-toggle button:hover { background-color: #f0f2f5; }
        .view-toggle button.active { background-color: #3498db; color: white; border-color: #3498db; }


        /* 5. Ø¹Ø±Ø¶ Ø§Ù„Ø´Ø¨ÙƒØ© (Grid View) */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            transition: all 0.5s;
        }
        .item {
            background-color: #fff;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
            overflow: hidden;
            text-align: center;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            border: none; /* Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø­Ø¯ÙˆØ¯ ÙˆØ§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¸Ù„ ÙˆØ§Ù„Ù…Ø¤Ø´Ø± Ø§Ù„Ù…Ù„ÙˆÙ† */
            position: relative;
            display: flex;
            flex-direction: column;
        }
        .item:hover { transform: translateY(-5px); box-shadow: 0 12px 25px rgba(0,0,0,0.15); }
        .item img {
            width: 100%;
            height: 250px;
            object-fit: cover;
        }

        /* Ù…Ø¤Ø´Ø± Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù…Ù„ÙˆÙ† ÙˆØ§Ù„Ù…Ø­Ø³Ù† */
        .result-tag {
            font-weight: 600;
            padding: 8px 10px;
            color: white;
            font-size: 0.9rem;
        }
        .real .result-tag { background-color: #2ecc71; }
        .fake .result-tag { background-color: #e74c3c; }
        .pending .result-tag { background-color: #f1c40f; }

        .details {
            padding: 15px 10px;
            text-align: left;
            flex-grow: 1;
        }
        .details p {
            margin: 4px 0;
            color: #67748e;
            font-size: 0.85rem;
        }
        .details strong { color: #344767; }
        
        /* 6. Ø´Ø±ÙŠØ· Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª ÙˆØ§Ù„ØªØ¯Ø±ÙŠØ¨ (Feedback Row) */
        .btn-row {
            display: flex;
            justify-content: space-around;
            gap: 5px;
            padding: 8px 10px;
            border-top: 1px solid #eee;
            background-color: #f7f9fc;
        }
        .btn-row button {
            flex-grow: 1;
            padding: 8px;
            font-size: 0.85rem;
            font-weight: 600;
            border-radius: 6px;
        }
        .btn-correct { background-color: #2ecc71; }
        .btn-wrong { background-color: #e67e22; }

        /* 7. Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© (List View) */
        .list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            transition: all 0.5s;
        }
        .list .item {
            display: flex;
            align-items: center;
            text-align: left;
            padding: 10px;
            border-radius: 10px;
        }
        .list .item img {
            width: 80px;
            height: 80px;
            border-radius: 8px;
            margin-right: 15px;
            flex-shrink: 0;
        }
        .list .details {
            flex-grow: 1;
            padding: 0;
        }
        .list .btn-row {
            border-top: none;
            background: none;
            justify-content: flex-end;
            padding: 0;
            gap: 10px;
            width: 200px;
            flex-shrink: 0;
        }
        .list .result-tag {
            /* ØªØ¹Ø¯ÙŠÙ„ Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØªØ§Ø¬ ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© */
            position: static;
            border-radius: 5px;
            margin-left: 10px;
        }
    </style>
</head>
<body>

<div class="top-bar">
    <h2>Detection Results ({{ logs|length }})</h2>
    
    <div class="controls">
        <div class="view-controls">
            <button class="btn filter-btn active" data-filter="all">All</button>
            <button class="btn filter-btn" data-filter="real" style="background-color: #2ecc71;">Real</button>
            <button class="btn filter-btn" data-filter="fake" style="background-color: #e74c3c;">Fake</button>
        </div>
        
        <div class="view-toggle">
            <button id="grid-view-btn" class="active">â–¦ Grid</button>
            <button id="list-view-btn">â˜° List</button>
        </div>
        
        <a href="{% url 'detector:camera_page' %}" class="btn btn-camera">ğŸ“· Camera</a>
        <a href="{% url 'detector:dashboard' %}" class="btn btn-dashboard">ğŸ“Š Dashboard</a>
        <form action="{% url 'detector:download_report' %}" method="get" style="display:inline;">
            <button type="submit" class="btn btn-report-pdf">â¬‡ï¸ PDF Report</button>
        </form>
        <form action="{% url 'detector:clear_results' %}" method="post" style="display:inline;">
            {% csrf_token %}
            <button type="submit" class="btn btn-clear">ğŸ—‘ï¸ Clear All</button>
        </form>
    </div>
</div>

<div id="results-container" class="grid">
    {% for log in logs %}
        <div class="item {{ log.result|default:'pending' }}" data-result="{{ log.result|default:'pending' }}">
            <img src="{{ log.image.url }}" alt="Detected Image">
            
            <div class="details">
                <p><strong>Result:</strong> <span class="result-tag">{{ log.result|upper|default:'PENDING' }}</span></p>
                <p><strong>Confidence:</strong> {{ log.confidence|default:'0'|floatformat:1 }}%</p>
                <p><strong>Time:</strong> {{ log.timestamp|default:'N/A'|date:"H:i:s, d M Y" }}</p> 
            </div>
            
            <div class="btn-row">
                <form action="{% url 'detector:mark_correct' log.id %}" method="post">
                    {% csrf_token %}
                    <button class="btn btn-correct">âœ… Correct</button>
                </form>
                <form action="{% url 'detector:mark_incorrect' log.id %}" method="post">
                    {% csrf_token %}
                    <button class="btn btn-wrong">âŒ Wrong</button>
                </form>
            </div>
        </div>
    {% empty %}
        <p style="padding: 20px; font-size: 1.1rem; color: #67748e;">No results yet. Upload some images or start a camera session first.</p>
    {% endfor %}
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const resultsContainer = document.getElementById('results-container');
        const gridViewBtn = document.getElementById('grid-view-btn');
        const listViewBtn = document.getElementById('list-view-btn');
        const filterBtns = document.querySelectorAll('.filter-btn');

        // 1. ÙˆØ¸ÙŠÙØ© ØªØ¨Ø¯ÙŠÙ„ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¹Ø±Ø¶ (Grid/List)
        function setView(viewType) {
            if (viewType === 'list') {
                resultsContainer.classList.remove('grid');
                resultsContainer.classList.add('list');
                listViewBtn.classList.add('active');
                gridViewBtn.classList.remove('active');
            } else { // Grid View
                resultsContainer.classList.remove('list');
                resultsContainer.classList.add('grid');
                gridViewBtn.classList.add('active');
                listViewBtn.classList.remove('active');
            }
        }
        
        // Ø±Ø¨Ø· Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¨Ø§Ù„ÙˆØ¸ÙŠÙØ©
        gridViewBtn.addEventListener('click', () => setView('grid'));
        listViewBtn.addEventListener('click', () => setView('list'));

        // 2. ÙˆØ¸ÙŠÙØ© Ø§Ù„ØªØµÙÙŠØ© (Filtering)
        function filterResults(filter) {
            const items = document.querySelectorAll('.item');
            items.forEach(item => {
                const result = item.getAttribute('data-result');
                if (filter === 'all' || result === filter) {
                    item.style.display = 'flex'; // Ø§Ø³ØªØ®Ø¯Ø§Ù… flex Ù‡Ù†Ø§ Ù„ÙŠØªÙˆØ§ÙÙ‚ Ù…Ø¹ ÙƒÙ„ Ù…Ù† list Ùˆ grid
                    if (resultsContainer.classList.contains('grid')) {
                         item.style.display = 'block'; // ØªØ¹Ø¯ÙŠÙ„ Ø®Ø§Øµ Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø´Ø¨ÙƒØ©
                    }
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // Ø±Ø¨Ø· Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØµÙÙŠØ©
        filterBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙ†Ø´ÙŠØ· Ù…Ù† Ø§Ù„Ø¬Ù…ÙŠØ¹
                filterBtns.forEach(b => b.classList.remove('active'));
                // ØªÙ†Ø´ÙŠØ· Ø§Ù„Ø²Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ
                this.classList.add('active');
                // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„ØªØ±
                filterResults(this.getAttribute('data-filter'));
            });
        });
        
        // Ø¥Ø¹Ø¯Ø§Ø¯ Ø£ÙˆÙ„ÙŠ: ØªØ·Ø¨ÙŠÙ‚ ÙÙ„ØªØ± 'all' Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
        filterResults('all'); 
    });
</script>
</body>
</html>