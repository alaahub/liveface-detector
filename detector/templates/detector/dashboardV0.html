{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Detection Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: "Segoe UI", sans-serif;
            background: #f7f9fb;
            margin: 0;
            padding: 40px;
        }
        h2 {
            text-align: center;
            color: #2c3e50;
        }
        .stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
            margin-top: 30px;
        }
        .card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            text-align: center;
            flex: 1 1 250px;
        }
        .card h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        .card p {
            font-size: 22px;
            font-weight: bold;
            color: #34495e;
        }
        .chart-container {
            width: 400px;
            margin: 50px auto;
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .back-link {
            display: block;
            text-align: center;
            margin-top: 40px;
            font-weight: bold;
            color: #2980b9;
            text-decoration: none;
        }
        .back-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <h2>üìä Face Detection Performance Dashboard</h2>

    <div class="stats">
        <div class="card" style="border-top: 5px solid #27ae60;">
            <h3>Real Faces</h3>
            <p>{{ total_real }}</p>
        </div>
        <div class="card" style="border-top: 5px solid #e74c3c;">
            <h3>Fake Faces</h3>
            <p>{{ total_fake }}</p>
        </div>
        <div class="card" style="border-top: 5px solid #3498db;">
            <h3>Model Accuracy</h3>
            <p>{{ accuracy }}%</p>
        </div>
    </div>

    <div class="chart-container">
        <h3 style="text-align:center;">Real vs Fake Distribution</h3>
        <canvas id="pieChart"></canvas>
    </div>

    <div class="chart-container">
        <h3 style="text-align:center;">Model Accuracy Trend</h3>
        <canvas id="accuracyChart"></canvas>
    </div>

    <a href="{% url 'detector:results_page' %}" class="back-link">‚Üê Back to Results</a>

    <script>
        // Pie chart for Real vs Fake
        const ctxPie = document.getElementById('pieChart').getContext('2d');
        const totalReal = Number("{{ total_real|default:0 }}");
        const totalFake = Number("{{ total_fake|default:0 }}");
        new Chart(ctxPie, {
            type: 'pie',
            data: {
                labels: ['Real Faces', 'Fake Faces'],
                datasets: [{
                    data: [totalReal, totalFake],
                    backgroundColor: [
                        'rgba(46, 204, 113, 0.7)',
                        'rgba(231, 76, 60, 0.7)'
                    ],
                    borderColor: [
                        'rgba(46, 204, 113, 1)',
                        'rgba(231, 76, 60, 1)'
                    ],
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { position: 'bottom' },
                    tooltip: { enabled: true }
                }
            }
        });

        // Accuracy gauge chart
        const ctxAcc = document.getElementById('accuracyChart').getContext('2d');
        const accValue = Number("{{ accuracy|default:0 }}");
        new Chart(ctxAcc, {
            type: 'doughnut',
            data: {
                labels: ['Accuracy', 'Remaining'],
                datasets: [{
                    data: [accValue, 100 - accValue],
                    backgroundColor: [
                        'rgba(52, 152, 219, 0.8)',
                        'rgba(189, 195, 199, 0.4)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                rotation: -90,
                circumference: 180,
                cutout: '70%',
                plugins: {
                    legend: { display: false },
                    tooltip: { enabled: false },
                    beforeDraw: function(chart) {
                        const width = chart.width,
                              height = chart.height,
                              ctx = chart.ctx;
                        ctx.restore();
                        const fontSize = (height / 80).toFixed(2);
                        ctx.font = fontSize + "em sans-serif";
                        ctx.textBaseline = "middle";
                        const text = accValue + "%",
                              textX = Math.round((width - ctx.measureText(text).width) / 2),
                              textY = height / 1.3;
                        ctx.fillText(text, textX, textY);
                        ctx.save();
                    }
                }
            }
        });
    </script>
</body>
</html>
